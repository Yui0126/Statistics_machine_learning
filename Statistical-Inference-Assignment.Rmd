---
title: 'Statistical Inference Final Project'
author: "Yui Naruse (1/1/2022)"
date:
output:
  pdf_document: default
  html_document: default
---

# Part 1: Simulation Exercise **Overview**
In this part 1 of the final project of *Coursera: Statistical Inference*, I conduced simulations of exponential distribution and compared the results with the Central Limit Theorem. The results are presented in the following order;


- **Exponential Distributions**. Comparing the distribution of 40 exponentials and 1000 simulated exponentials with sample size of 40.  
- **Comparison of the means**. Comparing the averages of the mean with the theoretical mean and evaluation of its distribution.  
- **Comparison of the variances**. Comparing the variance of the means of exponentials with theoretical variance and examining its distribution.  


From all these evaluations, it became clear that although the original shape of the exponential distribution has right skewed shape, the distribution of means of simulation of 40 exponentials has a shape close to that of normal distribution and it's concentrated around theoretical mean. The variance, standard deviation and standard error are also close to the theoretical values.

```{r, echo=FALSE, results='hide', message=FALSE}
library(devtools)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(knitr)
library(kableExtra)
library(tinytex)
```

```{r setup, echo=FALSE, results='hide', include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

**Setting conditions:**
Before conducting simulations and comparisons, specific numbers were assigned to certain values as shown in the Table 1.
```{r, echo=FALSE}
set.seed(100000)
lambda <- 0.2
sim <- 1000 # number of simulations
sampsize <- 40 # number of samples
theomean <- 1/0.2 # theoretical mean
theovar <- 1/lambda^2/sampsize #theoretical variance
theosd <- sqrt(theovar) # theoretical standard deviation
theose <- theosd/sqrt(sampsize) # theoretical standard error
```

```{r, echo=FALSE}
a <- c("theoretical mean", "theoretical variance","theoretical standard 
       deviation","theoretical standard error")
b <- round(c(theomean, theovar, theosd, theose), 3)
values <- data.frame(a,b)
knitr::kable(values, col.names = NULL, caption = "Theoretical Values") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```



### **Exponential Distribution**
Firstly, exponential distribution of sample size 40 with lambda 0.2 was obtained through function `rexp` as shown in the left figure on the next page. Since the number of sample is small, the distribution seems rather bumpy but we can see that it has right skewed shape. If we conduct 1000 simulations of such 40 exponentials, the distribution looks smoother as shown in the gifure on the right.

```{r, fig.align = 'center', fig.show='hold', out.width="40%", echo=FALSE}
# 40 exponentials
expo40 <- rexp(sampsize, lambda)
expo40data <- as.data.frame(expo40)
ggplot(expo40data, aes(x=expo40)) +
  geom_histogram(bins = 40, color = "darkblue", fill = "lightsteelblue2") +
  labs(title = "Distribution of 40 exponentials") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("x")

# 1000 simulations of 40 exponentials
expo <- NULL
for (i in 1:1000) expo = c(expo, rexp(sampsize, lambda))
expodata <- as.data.frame(expo)
ggplot(expodata, aes(x=expo)) +
  geom_histogram(bins = 60, color = "darkblue", fill = "lightsteelblue2") +
  labs(title = "Distribution of 1000 Simulated Exponentials") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("x")
```



### **Comparison of the means**  
Now that we got the simulated data of exponentials, we can compare its distribution of averages of the sample mean and its value with the theoretical mean.
```{r, echo=FALSE}
di <- gl(1000, 40)
simmean <- tapply(expo, di, mean)
simmeandata <- as.data.frame(simmean)
```


The absolute value of the differences between mean of all the averages of the sampled exponentials and the theoretical mean was only **0.01403**.
```{r, echo=FALSE, fig.show='hold'}
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "")
sampmean <- round(mean(simmean), 5) # mean of all the averages 
difmean <- round(abs(sampmean - theomean),5)

a <- c("sample", sampmean)
b <- c("theoretical", theomean)
c <- c("difference", difmean)
mean <- data.frame(a,b,c)
knitr::kable(mean, col.names = NULL, caption = "Comparing the means") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```


From the distribution of the averages of the mean of 40 exponentials shown in the left figure, it can be said that the distribution closely follows that of normal distribution with almost symmetrical shape. It's also centered around theoretical mean, which was 5.

From the plot on the right side, we can see that the difference is so small that it is almost overlapping when plotted without scaling. The black line is the sample mean and the salmon colored line is the theoretical mean.
```{r, figures-side, fig.show='hold', out.width="50%", message=FALSE, echo=FALSE}
fig <- ggplot(simmeandata, aes(x=simmean)) +
  geom_histogram(bins = 60, color = "darkblue", fill = "lightsteelblue2") +
  geom_vline(aes(xintercept = mean(simmean)), 
             color = "black", size = 1.3) +
  geom_vline(aes(xintercept = theomean), color = "salmon", size = 1.3) +
  labs(title = "Distribution of Averages of the Means") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("mean")
fig
fig + scale_x_continuous(limits = c(4.9,5.1)) +
  labs(title = "Scaling the x axis") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("mean")
```


### **Comparison of the variances**  
In this section, evaluation and comparison of the variances of the simulated exponentials were conducted.

when you divide variance with sample size, it is no longer measuring the variability of the exponentials, but it is talking about the variability of the averages of the exponentials.


Firstly, the difference of the sample variance and theoretical variance was calculated. We can see that the difference was again quite small with **0.05381**.
```{r, echo=FALSE, fig.show='hold'}
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "")
sampvar <- round(var(simmean), 5)
dif <- round(abs(sampvar - theovar), 5)
a <- c("sample", sampvar)
b <- c("theoretical", theovar)
c <- c("difference", dif)
vari <- data.frame(a,b,c)
knitr::kable(vari, col.names = NULL, caption = "Comparing the variances") %>%
  kable_styling(full_width = F, latex_options = "hold_position") # this one worked
```

**Distribution of the sample variances:**
The variance of the 1000 simulated 40 exponentials was calculated as follows.  
Note that when you divide the variance with sample size (which is 40), it calculates the variance of the distribution of of the means of samples of 40 exponentials.
```{r, echo=FALSE}
vartest <- tapply(expo, di, var);
vartest <- as.data.frame(vartest)
vartest <- vartest %>%
  mutate(sv = vartest/sampsize)
colnames(vartest) <- c("variance", "sv")
```

In order to evaluate the nature of sample variance($S^2$), the sample variance  of the exponentials was calculated and compared to the theoretical variance. Distribution plot of the variances of each exponentials was also plotted. As shown below, the sample variance is centered around the theoretical variance (population variance).  
```{r, fig.show='hold', out.width="50%", fig.align='center', echo=FALSE}
vartest <- vartest %>%
  mutate(n = replicate(1000, "40"))

ggplot(vartest, aes(x = sv, fill = n, color = n)) +
  geom_density(size = 1.5, alpha = 0.5) +
  scale_color_brewer(palette = "Paired") +
  scale_fill_brewer(palette ="Paired") +
  geom_vline(xintercept = theovar, size = 1.5, color = "salmon") +
  xlab("Variance of the Averages of the Means")
```


#### Evaluating the standard deviation and standard error:  

Along with the sample variances, we can also calculate **the standard deviation**: $S$, which shows how variable the population is, and **the standard error**: $\frac{S}{\sqrt{n}}$, which shows how variable the averages of random samples are from the population, to compare them with the theoretical values.

```{r,out.width="40%", echo=FALSE}
# standard deviation
sampsd <- round(sqrt(sampvar),5)
theosd <- round(theosd, 5)
difsd <- round(abs(sampsd - theosd),5)
sampse <- round(sampsd/sqrt(sampsize),5)
theose <- round(theose, 5)
difse <- round(abs(sampse - theose),5)
a <- c(" ", "Standard deviation", "Standard error")
b <- c("sample", sampsd,sampse)
c <- c("theoretical",theosd,theose)
d <- c("difference",difsd,difse)
sd <- data.frame(a,b,c,d)
knitr::kable(sd, col.names = NULL, caption = "Comparing theoretical and 
sample values of Standard Deviation and Standard Error") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```


### Conclusions  
From the examination of the 1000 simulations of exponentials, we could see that when we have enough sample, the values yielded by analyses (i.e. sample mean and variances) tend to get close to that of the theoretical values.
This conclusion is significant as it implies that the more samples we get and do more simulations, the more likely we get good approximation of the true population value. However, it should not be forgotten that if the sample has skewed data it could not be used as the representation of the population. 


\newpage

# Part 2: Basic Inferential Data Analysis **Overview**
The dataset ["ToothGrowth"](https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/ToothGrowth) contains information about the length of odontoblasts (cells responsible for the tooth growth) in 60 guinea pigs. Results of the analysis are presented in the following order.

- **Sumamry Statistics of the dataset**. Summary statistics and distribution of the tooth length grouped by the delivery method of vitamin c (i.e. orange juice or ascorbic acid) and its dose.
- **Confidence Interval and Hypothesis Testing**. Evaluation of whether method and/or dose affect tooth growth through Confidence Interval and Hypothesis Testing.

In summary, analyses showed that the vitamin C dose, instead of its delivery method plays and important role in tooth growth, where higher doses resulted in higher level of tooth growth.

## **Summary statistics grouped by vitamin C delivery method and dose**
From the statistics in Table 5 and 6 below, we can see that both method and dose seem to be playing role in the tooth length as especially the mean and median of the tooth length is higher among those given with orange juice (`OJ`) or with higher doses (`dose`).

```{r, out.width="60%", echo=FALSE}
data(ToothGrowth)
ToothGrowth$dose <- as.factor(ToothGrowth$dose)
oj <- ToothGrowth[ToothGrowth$supp == "OJ",]
vc <- ToothGrowth[ToothGrowth$supp == "VC",]
dose_0.5 <- ToothGrowth[ToothGrowth$dose == "0.5",]
dose_1 <- ToothGrowth[ToothGrowth$dose == "1",]
dose_2 <- ToothGrowth[ToothGrowth$dose == "2",]

valueoj <- oj %>%
  summarise(mean = round(mean(len),3), median = median(len), min = min(len), 
            max = max(len), sd = round(sd(len),3))
valuevc <- vc %>%
  summarise(mean = round(mean(len),3), median = median(len), min = min(len), 
            max = max(len), sd = round(sd(len),3))
summary <- rbind(valueoj, valuevc)
rownames(summary) <- c("Orange Juice", "Vitamin C")
knitr::kable(summary, caption = "Tooth length grouped by method") %>%
  kable_styling(full_width = F, latex_options = "hold_position")

value0.5 <- dose_0.5 %>%
  summarise(mean = round(mean(len),3), median = median(len), min = min(len), 
            max = max(len), sd = round(sd(len),3))
value1 <- dose_1 %>%
  summarise(mean = round(mean(len),3), median = median(len), min = min(len), 
            max = max(len), sd = round(sd(len),3))
value2 <- dose_2 %>%
  summarise(mean = round(mean(len),3), median = median(len), min = min(len), 
            max = max(len), sd = round(sd(len),3))
summarize <- do.call("rbind", list(value0.5,value1,value2))
rownames(summarize) <- c("0.5", "1","2")
knitr::kable(summarize, caption = "Tooth length summary grouped by dose") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```

### **Distributions of the samples**  

It is also helpful to take a look at the histograms and boxplot grouped by method and dose shown below. We can see that those with `VC` have wider range of distribution, whereas that of `OJ` is more concentrated around the median which was higher than that of `VC`. From the one grouped by dose, we can see clearer difference in distribution, where doses `0.5` seems to be distributed on lower tail whereas `2` seems to be distributed on upper tail.

```{r, fig.show='hold', out.width="40%",  fig.align='center', echo=FALSE}
ggplot(ToothGrowth, aes(x=len, fill = supp, color = supp)) +
  geom_histogram(bins = 60) +
  labs(title = "Distribution of the tooth length") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("length")

ggplot(ToothGrowth, aes(x=len, fill = dose, color = dose)) +
  geom_histogram(bins = 60) +
  labs(title = "Distribution of the tooth length") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("length")

ggplot(ToothGrowth, aes(x=supp, y=len, fill=dose)) +
  geom_boxplot(width=0.4) +
  labs(title = "Boxplot of the tooth length") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("method") +
  ylab("tooth length")
```

## **Confidence Interval**
So, could we actually say that different delivery method and/or dose correlates with the average tooth length? Confidence intervals were calculated using `t.test` function and the results are presented in the table below. \newline As for the result comparing the `OJ` and `VC` contains $0$, we cannot conclude that the method is correlated with the tooth length. However, for all the values comparing the doses show the higher the dose is, the higher the tooth growth, with the result showing highest significance between doses `0.5` and `2`. In other words, when a guinea pig was given 2 doses of vitamin C, the subject likely showed tooth growth of $12.834$ to $18.156$ higher on average compared to those given only `0.5`.


```{r fig.show='hold', out.width="60%",  fig.align='center', echo=FALSE}
methodoj <- oj[,1]
methodvc <- vc[,1]
dose0.5 <- dose_0.5[,1]
dose1 <- dose_1[,1]
dose2 <- dose_2[,1]
ci_oj_vs_vc <- round(t.test(methodoj, methodvc, paired = FALSE)$conf,3)
ci_0.5_vs_1 <- round(t.test(dose1, dose0.5, paired = FALSE)$conf,3)
ci_0.5_vs_2 <- round(t.test(dose2, dose0.5, paired = FALSE)$conf,3)
ci_1_vs_2 <- round(t.test(dose2, dose1, paired = FALSE)$conf,3)

df <- do.call("rbind", list(ci_oj_vs_vc,ci_0.5_vs_1,ci_0.5_vs_2,ci_1_vs_2))
rownames(df) <- c("OJ vs VC","0.5 vs 1","0.5 vs 2","1 vs 2")
knitr::kable(df, caption = "Confidence Intervals vs each group") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```
## **Hypothesis Testing**
We can also reach the same conclusion by conducting Hypothesis test with the following hypotheses.  

- $H_0$: There is no difference in the tooth length between different groups.  
- $H_a$: There is significant difference in the tooth length between different groups.  

As I do not want to commit type 1 error, I will set two sided significance level $\alpha$ to be $0.05$ with degree of freedom 55(see codes how I got this value), meaning we need the t-value to be more than $2$ to reject null hypothesis. \newline As shown in the Table 8, we can see that the t-value between different method group is less than $2$ and the p-value is also more than $0.05$, meaning we cannot reject $H_0$. On the other hand, all the values concerning different groups of doses have higher than $2$ t-value and quite low p-value, suggesting vitamin C dose playing significant role in tooth growth. 

```{r, out.width="40%",  fig.align='center', echo=FALSE}
mt <- as.data.frame(round(t.test(methodoj, methodvc, paired = FALSE)$statistic,3))
mp <- as.data.frame(round(t.test(methodoj, methodvc, paired = FALSE)$p.value,3))
dose0.5_1t <- as.data.frame(round(t.test(dose1, dose0.5, paired = FALSE)$statistic,3))
dose0.5_1p <- as.data.frame(round(t.test(dose1, dose0.5, paired = FALSE)$p.value,7))
dose0.5_2t <- as.data.frame(round(t.test(dose2, dose0.5, paired = FALSE)$statistic,3))
dose0.5_2p <- as.data.frame(round(t.test(dose2, dose0.5, paired = FALSE)$p.value,7))
dose1_2t <- as.data.frame(round(t.test(dose2, dose1, paired = FALSE)$statistic,3))
dose1_2p <- as.data.frame(round(t.test(dose2, dose1, paired = FALSE)$p.value,7))
table <- data.frame()
table <- matrix(table, 4,2)
mtp <- c(mt,mp)
dose0.51tp <- c(dose0.5_1t,dose0.5_1p)
dose0.52tp <- c(dose0.5_2t,dose0.5_2p)
dose12tp <- c(dose1_2t,dose1_2p)
table <- do.call("rbind", list(mtp,dose0.51tp,dose0.52tp,dose12tp))
colnames(table) <- c("t-value","p-value")
rownames(table) <- c("OJ vs VC","0.5 vs 1","0.5 vs 2","1 vs 2")
knitr::kable(table, caption = "Hypothesis Testing") %>%
  kable_styling(full_width = F, latex_options = "hold_position")
```
\newpage 
## **Conclusion**  
Through the evaluation of confidence interval and hypothesis testing, we can conclude that the vitamin C dose, rather than its delivery method plays an important role in deciding the tooth length. However, it is worth noting that if I set the significance level a bit higher (e.g. $0.1$), the hypothesis testing evaluating the effectiveness of delivery method could have yielded a significant t-value. Also it should be noted that the result might be quite different if we had larger sample size. All things considered, the results imply the effectiveness of vitamin C in tooth growth and it will be interesting to conduct an experiment on human to see if we can get similar result. 


#### Thank you for taking the time to review my report! :)


\newpage

# Appendix: Codes for this report

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```